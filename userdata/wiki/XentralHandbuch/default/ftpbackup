<span style="font-size:28px;"><strong>Automatisches Backup per FTP einrichten</strong></span><br /><br />Dieses Modul erm&ouml;glicht ein automatisches Backup &uuml;ber einen Cronjob und FTP.<br /><br /><span style="font-size:16px;"><strong>Bitte sichern Sie regelm&auml;&szlig;ig folgende Bereiche:</strong></span><ul><li>Ordner userdata</li><li>Dump der MySQL Datenbank</li></ul><br />Wir empfehlen den Ordner userdata und das letzte MySQL Backup jede Nacht per FTP auf einen externen Server zu &uuml;bertragen. Tags&uuml;ber empfehlen wir die Datenbank z.B. um 07.00 Uhr / 12.00 Uhr / 15.00 Uhr und 18.00 Uhr zu sichern. So w&auml;re ein Verlust maximal 1/3 Arbeitstag. Bei hohem Aufkommen kann die Frequenz entsprechend angepasst werden.<br /><br />Die Sicherung erfolgt per Cronjob. Optional k&ouml;nnten Sie &uuml;ber &quot;Administration &rarr; Backup&quot; auch per Browser manuell einen Snapshot bzw. ein Backup anlegen oder herunterladen. Die Informationen finden Sie hier.<br /><br />&nbsp;<h1>Automatisches FTP-Backup in Xentral einrichten</h1> Um ein automatisches FTP-Backup in Wawision einzurichten, ben&ouml;tigen Sie folgende Zugangsdaten und Rechte:<ul><li>Zugangsdaten zu Ihren FTP-Server</li><li>Zugangsdaten zu Ihrer MySQL-Datenbank</li><li>Lese- und Schreibzugriff auf das HTTP Verzeichnis Ihres Xentral-Servers</li><li>Administratorrechte (root) f&uuml;r den Xentral-Server, um den cronjob f&uuml;r das FTP-Backup einzurichten.</li></ul>&nbsp;<h2>Die FTP-Backup App</h2> Im ersten Schritt m&uuml;ssen Sie die Zugangsdaten zu Ihrem FTP-Server in Xentral hinterlegen.<br /><br /><img src="index.php?module=wiki&amp;action=getfile&amp;workspacefolder=XentralHandbuch&amp;article=ftpbackup&amp;fileid=1" /><br /><br /><br />Hier m&uuml;ssen Sie die Zugangsdaten zu Ihrem FTP-Server eintragen. Diese App dient lediglich der Kontrolle, ob die Backups regelm&auml;&szlig;ig abgelegt werden.<br /><br /><br /><img src="index.php?module=wiki&amp;action=getfile&amp;workspacefolder=XentralHandbuch&amp;article=ftpbackup&amp;fileid=2" /><br /><br /><br />Tragen Sie die Zugangsdaten zum Ihren FTP-Server in die Felder ein.<br /><br />&nbsp;<h2>FTP-Backup einrichten</h2> Damit das Backup automatisch startet, m&uuml;ssen die Zugangsdaten f&uuml;r die SQL-Datenbank und FTP-Server in das FTP-Backup-Script eingetragen werden.<br /><br />Hierzu rufen Sie bitte unter Linux die Console (Terminal) auf und melden sich als <strong>root</strong> an.<br /><br />Um sich als root anzumelden, geben Sie bitte in die Console sudo su ein und best&auml;tigen Sie den Befehl mit ENTER. Danach fragt Sie das System nach einen Passwort, dieses m&uuml;ssen Sie auch eingeben und mit ENTER best&auml;tigen.  Bitte beachten Sie, dass bei der Passworteingabe die Buchstaben nicht angezeigt werden.Jetzt wechseln Sie bitte in das Verzeichnis, wo die FTP-Backup-Script Dateien liegen. In der Regel finden Sie die Dateien unter <strong>/var/www/http/backup/</strong>.<p>Um in das Verzeichnis zu wechseln, geben Sie folgenden Befehl in die Console ein:<strong> </strong></p><pre>cd /var/www/html/backup/</pre><br />Wenn Sie jetzt in der Console <strong>ls</strong>  eingeben, werden Ihnen zwei Ordner und zwei Dateien angezeigt.<br /><br />F&uuml;r Sie sind nur die Dateien <strong>mysql_ftp.php.tpl</strong> und <strong>userdata_ftp.php.tpl </strong>wichtig, diese beinhalten das FTP-Backup-Script f&uuml;r die Datenbank <strong>mysql_ftp.php.tpl </strong>und f&uuml;r das userdata Verzeichnis <strong>userdata_ftp.php.tpl</strong>.<br /><br />Als erstes m&uuml;ssen Sie die beiden Dateien umbenennen. Hierzu geben Sie bitte folgenden Befehl in die Console ein  mv <strong>mysql_ftp.php.tpl mysql_ftp.php</strong>  ENTER und dann  <strong>mv userdata_ftp.php.tpl userdata_ftp.php</strong> ENTER.<br /><br />Nachdem die Dateien umbenannt sind, m&uuml;ssen Sie diese jetzt bearbeiten und die Zugangsdaten zu Ihrer SQL-Datenbank und dem FTP-Server hinterlegen.<br /><br />Hierzu geben Sie folgenden Befehl in die Console ein:<pre>nano mysql_ftp.php</pre>und best&auml;tigen diesen mit ENTER.<br /><br /><img src="index.php?module=wiki&amp;action=getfile&amp;workspacefolder=XentralHandbuch&amp;article=ftpbackup&amp;fileid=3" /><br /><br /><br />Passen Sie nun diese Zeilen f&uuml;r den SQL Zugang an:<pre>$WFdbname=<em>;
</em>$WFdbuser=;
$WFdbpass=;</pre><br />in z.B.:<pre>$WFdbname=&#39;wawision&#39;;
$WFdbuser=&#39;root&#39;;
$WFdbpass=&#39;12345&#39;;</pre><br />Und die Zeilen f&uuml;r den FTP-Zugang:<pre>$ftp_server=&quot;&quot;;
$ftp_user_name=&quot;&quot;;
$ftp_user_pass=&quot;&quot;;</pre><br />in z.B.: <pre>
$ftp_server=&quot;192.168.0.201&ldquo;;
$ftp_user_name=&quot;ftpbackup&quot;;
$ftp_user_pass=&quot;12345&quot;;</pre><br />Um die &Auml;nderungen zu speichern, dr&uuml;cken Sie bitte anschlie&szlig;end auf Ihrer Tastatur &ldquo;STRG+O&ldquo; und best&auml;tigen Sie das Speichern mit ENTER. Anschlie&szlig;end dr&uuml;cken Sie die Tasten &ldquo;STRG+X&ldquo;, um den Editor zu verlassen.<br /><br />Jetzt bearbeiten wir die zweite Datei mit dem Befehl nano userdata_ftp.php und best&auml;tigen diesen mit ENTER.<br /><br /><img src="index.php?module=wiki&amp;action=getfile&amp;workspacefolder=XentralHandbuch&amp;article=ftpbackup&amp;fileid=4" /><br /><br /><br />Und die Zeilen f&uuml;r den FTP-Zugang:<pre>$ftp_server=&quot;&quot;;
$ftp_user_name=&quot;&quot;;
$ftp_user_pass=&quot;&quot;;

</pre><p>&nbsp;in z.B.: </p><pre>
$ftp_server=&quot;192.168.0.201&ldquo;; 
$ftp_user_name=&quot;ftpbackup&quot;; 
$ftp_user_pass=&quot;12345&quot;;</pre><br />Um die &Auml;nderungen zu speichern, dr&uuml;cken Sie bitte anschlie&szlig;end auf Ihrer Tastatur &ldquo;<strong>STRG+O&ldquo; </strong>und best&auml;tigen Sie das Speichern mit <strong>ENTER</strong>. Anschlie&szlig;end dr&uuml;cken Sie die Tasten <strong>&ldquo;STRG+X&ldquo;</strong>, um den Editor zu verlassen.<br /><br />Sollte die Installation von Xentral in einem anderen Verzeichnis abgelegt sein als in userdata_ftp.php vorgegeben, so m&uuml;ssen Sie die Zeile entsprechend anpassen: <br /><br />$userdata = &quot;/var/www/html/userdata&quot;;<br /><br /><strong>Tipp</strong>: Mit dem Befehl php mysql_ftp.php gefolgt von ENTER k&ouml;nnen Sie das Script starten und auf Ihrem FTP-Server per FTP-Client nachsehen, ob das Backup abgelegt wird. Das k&ouml;nnen Sie auch mit der userdata_ftp.php ausprobieren.<h1><br />Cronjob f&uuml;r das FTP-Backup einrichten</h1> Damit das Backup jetzt automatisch startet, muss der cronjob auf dem Server um zwei neue Befehle erg&auml;nzt werden.<br /><br />Um die Cronjob-Datei zu bearbeiten, geben Sie in der Console folgenden Befehl ein: <strong>sudo crontab -e -u www-data </strong>und best&auml;tigen Sie mit ENTER.  <br /><br />F&uuml;gen Sie am Ende der Daten folgende Zeilen hinzu:<pre>0 0 * * * php /var/www/html/backup/mysql_ftp.php
0 1 * * * php /var/www/html/backup/userdata_ftp.php</pre><br />Die erste Zeile startet das SQL Backup jeden Tag um 0:00 Uhr und die zweite Zeile das userdata Backup jeden Tag um 1:00 Uhr.<br /><br />Die Eintr&auml;ge sollten in etwa so aussehen:<br /><br /><img src="index.php?module=wiki&amp;action=getfile&amp;workspacefolder=XentralHandbuch&amp;article=ftpbackup&amp;fileid=5" /><br /><br /><br />Um die &Auml;nderungen zu speichern, dr&uuml;cken Sie bitte anschlie&szlig;end auf Ihrer Tastatur <strong>&ldquo;STRG+O&ldquo;</strong> und best&auml;tigen Sie das Speichern mit <strong>ENTER</strong>. Anschlie&szlig;end dr&uuml;cken Sie die Tasten <strong>&ldquo;STRG+X&ldquo; </strong>um den Editor zu verlassen.<br /><br />Sollte die Installation von Xentral in einem anderen Verzeichnis abgelegt sein als in Beispiel vorgegeben, so m&uuml;ssen Sie die Zeilen entsprechend anpassen:<br />&nbsp;<pre>0 0 * * * php /var/www/html/backup/mysql_ftp.php
 0 1 * * * php /var/www/html/backup/userdata_ftp.php</pre><br />Einspielen von BackupsDumps sollten mit dem Kommandozeilen Tool mysql eingespielt werden:<br /><a href="https://dev.mysql.com/doc/refman/5.7/en/mysql-batch-commands.html">https://dev.mysql.com/doc/refman/5.7/en/mysql-batch-commands.html</a>